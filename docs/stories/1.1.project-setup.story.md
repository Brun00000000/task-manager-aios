# Story 1.1: Project Setup & CI/CD Pipeline

## Status
Done

## Executor Assignment

```yaml
executor: "@dev"
quality_gate: "@architect"
quality_gate_tools:
  - code-review
  - architecture-validation
  - ci-pipeline-verification
```

> **Work Type:** Code/Features/Logic + Infra/CI/CD/Deploy
> **Supporting Agent:** @devops (configuraÃ§Ã£o Vercel e GitHub Actions)

---

## Story

**As a** desenvolvedor,
**I want** o projeto Next.js inicializado com TypeScript, Tailwind e pipeline de CI/CD configurado,
**so that** a equipe tenha uma base estÃ¡vel para construir todas as features subsequentes.

---

## Acceptance Criteria

1. Next.js 16+ com App Router e TypeScript inicializado e rodando localmente
2. Tailwind CSS + shadcn/ui configurados com tema padrÃ£o funcional
3. ESLint + Prettier configurados com regras do preset `nextjs-react`
4. RepositÃ³rio GitHub criado com branches `main` e `develop`
5. GitHub Actions executa lint + typecheck + testes a cada push/PR
6. Deploy automÃ¡tico na Vercel configurado (preview em PRs, produÃ§Ã£o no merge para `main`)
7. Rota `/api/health` retorna `{ status: "ok", timestamp }` com HTTP 200
8. PÃ¡gina inicial exibe "Task Manager â€” Coming Soon" confirmando deploy funcionando

---

## ðŸ¤– CodeRabbit Integration

> **CodeRabbit Integration**: Disabled
>
> CodeRabbit CLI is not enabled em `core-config.yaml`.
> ValidaÃ§Ã£o de qualidade usarÃ¡ processo de review manual.
> Para habilitar, defina `coderabbit_integration.enabled: true` em core-config.yaml

---

## Tasks / Subtasks

- [x] **Task 1: Inicializar projeto Next.js 16+** (AC: 1)
  - [x] 1.1 Executar `npx create-next-app@latest task-manager --typescript --tailwind --app --src-dir --import-alias "@/*"`
  - [x] 1.2 Verificar que `npm run dev` inicia sem erros em `localhost:3000`
  - [x] 1.3 Confirmar App Router funcional (pasta `src/app/` criada)
  - [x] 1.4 Confirmar TypeScript funcional (`tsconfig.json` vÃ¡lido, sem erros de tipo)

- [x] **Task 2: Configurar Tailwind CSS + shadcn/ui** (AC: 2)
  - [x] 2.1 Verificar `tailwind.config.ts` gerado pelo `create-next-app` (Tailwind 4.x)
  - [x] 2.2 Inicializar shadcn/ui: `npx shadcn@latest init` (selecionar tema padrÃ£o)
  - [x] 2.3 Instalar componentes base: `npx shadcn@latest add button card input label`
  - [x] 2.4 Verificar que componentes shadcn importam e renderizam corretamente

- [x] **Task 3: Configurar ESLint + Prettier** (AC: 3)
  - [x] 3.1 Verificar `.eslintrc.json` gerado (deve estender `next/core-web-vitals`)
  - [x] 3.2 Instalar Prettier: `npm install -D prettier eslint-config-prettier`
  - [x] 3.3 Criar `.prettierrc` com configuraÃ§Ã£o padrÃ£o:
        `{ "semi": false, "singleQuote": true, "tabWidth": 2, "trailingComma": "es5" }`
  - [x] 3.4 Adicionar `"prettier"` ao extends do ESLint (apÃ³s `next/core-web-vitals`)
  - [x] 3.5 Adicionar script ao `package.json`: `"typecheck": "tsc --noEmit"`
  - [x] 3.6 Executar `npm run lint` e confirmar sem erros
  - [x] 3.7 Executar `npm run typecheck` e confirmar sem erros

- [x] **Task 4: Configurar RepositÃ³rio GitHub** (AC: 4)
  - [x] 4.1 Criar repositÃ³rio `task-manager` no GitHub (pÃºblico ou privado)
  - [x] 4.2 Criar `.gitignore` incluindo: `.env.local`, `.env*.local`, `node_modules/`, `.next/`
  - [x] 4.3 Push inicial para branch `main`
  - [x] 4.4 Criar branch `develop` a partir de `main`: `git checkout -b develop && git push -u origin develop`

- [x] **Task 5: Configurar Ferramentas de Teste** (prerequisite para AC: 5)
  - [x] 5.1 Instalar Vitest + RTL: `npm install -D vitest @vitejs/plugin-react @testing-library/react @testing-library/jest-dom jsdom`
  - [x] 5.2 Criar `vitest.config.ts` (ver Dev Notes â€” SeÃ§Ã£o Testing)
  - [x] 5.3 Criar `src/test/setup.ts` com `import '@testing-library/jest-dom'`
  - [x] 5.4 Adicionar script ao `package.json`: `"test": "vitest run"`
  - [x] 5.5 Instalar Playwright: `npm install -D @playwright/test && npx playwright install`
  - [x] 5.6 Criar `playwright.config.ts` (ver Dev Notes â€” SeÃ§Ã£o Testing)
  - [x] 5.7 Adicionar script: `"test:e2e": "playwright test"`
  - [x] 5.8 Confirmar `npm run test` e `npm run test:e2e` passam (sem testes = pass)

- [x] **Task 6: Criar rota `/api/health`** (AC: 7)
  - [x] 6.1 Criar `src/app/api/health/route.ts` (ver Dev Notes â€” cÃ³digo exato)
  - [x] 6.2 Testar localmente: `curl http://localhost:3000/api/health` retorna `{ "status": "ok", "timestamp": "..." }`
  - [x] 6.3 Escrever teste unitÃ¡rio: `src/app/api/health/route.test.ts` verificando status 200 e campos da resposta

- [x] **Task 7: Criar pÃ¡gina inicial "Coming Soon"** (AC: 8)
  - [x] 7.1 Atualizar `src/app/page.tsx` com conteÃºdo: `<h1>Task Manager â€” Coming Soon</h1>`
  - [x] 7.2 Estilizar minimamente com Tailwind CSS

- [x] **Task 8: Configurar GitHub Actions CI/CD** (AC: 5)
  - [x] 8.1 Criar `.github/workflows/ci.yaml` com jobs `quality` e `e2e` (ver Dev Notes â€” cÃ³digo exato)
  - [x] 8.2 Testar pipeline: push para `develop` e verificar workflow passa
  - [x] 8.3 Confirmar que PR para `main` aciona workflow

- [x] **Task 9: Configurar Vercel Deploy** (AC: 6)
  - [x] 9.1 Conectar repositÃ³rio ao Vercel via dashboard (Import Project)
  - [x] 9.2 Verificar deploy automÃ¡tico: push para `main` â†’ produÃ§Ã£o, PR â†’ preview
  - [x] 9.3 Criar `.env.example` com todas as variÃ¡veis (sem valores reais)
  - [x] 9.4 Verificar URL de produÃ§Ã£o acessÃ­vel e exibindo "Task Manager â€” Coming Soon"

- [x] **Task 10: VerificaÃ§Ã£o final e testes** (AC: 1-8)
  - [x] 10.1 Executar `npm run lint && npm run typecheck && npm run test` â€” todos passando
  - [x] 10.2 Verificar `/api/health` na URL de produÃ§Ã£o Vercel retorna HTTP 200
  - [x] 10.3 Confirmar pipeline CI verde no GitHub Actions
  - [x] 10.4 Confirmar deploy preview funciona em PRs

---

## Dev Notes

### Contexto da Story

Esta Ã© a story **fundacional** do projeto Task Manager. NÃ£o hÃ¡ cÃ³digo existente â€” tudo deve ser criado do zero via `create-next-app`. As pastas `features/`, `lib/`, `components/ui/` (shadcn), `types/` serÃ£o estruturadas em stories subsequentes. NÃ£o criar estrutura antecipada alÃ©m do que os ACs exigem.

### Stack e VersÃµes
[Source: architecture/task-manager-architecture.md#3-tech-stack]

| Ferramenta | VersÃ£o | Notas |
|-----------|--------|-------|
| Next.js | 16+ | App Router, TypeScript |
| TypeScript | 5.x | Configurado pelo create-next-app |
| Tailwind CSS | 4.x | Flag `--tailwind` no create-next-app |
| shadcn/ui | latest | `npx shadcn@latest init` |
| ESLint | latest | Configurado pelo create-next-app |
| Prettier | latest | Instalar manualmente |
| Vitest | 2.x | Com @testing-library/react (RTL) |
| Playwright | 1.x | E2E â€” fluxos crÃ­ticos |
| Turbopack | â€” | Bundler padrÃ£o em dev (Next.js 16+) |

### Estrutura de Pastas a Criar Nesta Story
[Source: architecture/task-manager-architecture.md#12-unified-project-structure]

```
task-manager/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ ci.yaml              â† criar nesta story
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ health/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts     â† criar nesta story (AC: 7)
â”‚   â”‚   â”œâ”€â”€ page.tsx             â† "Coming Soon" (AC: 8)
â”‚   â”‚   â”œâ”€â”€ layout.tsx           â† gerado pelo create-next-app
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ setup.ts             â† setup do Vitest
â”œâ”€â”€ public/
â”œâ”€â”€ e2e/                         â† criar pasta para Playwright
â”œâ”€â”€ .env.example                 â† criar (sem valores reais)
â”œâ”€â”€ .gitignore                   â† incluir .env.local
â”œâ”€â”€ next.config.ts
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vitest.config.ts             â† criar nesta story
â”œâ”€â”€ playwright.config.ts         â† criar nesta story
â””â”€â”€ package.json
```

**NÃƒO criar nesta story:** `supabase/`, `src/features/`, `src/lib/`, `src/types/`, `src/middleware.ts`

### CÃ³digo: Rota `/api/health`
[Source: architecture/task-manager-architecture.md#5-api-specification]

```typescript
// src/app/api/health/route.ts
import { NextResponse } from 'next/server'

export async function GET() {
  return NextResponse.json({
    status: 'ok',
    timestamp: new Date().toISOString(),
  })
}
```

### CÃ³digo: `.github/workflows/ci.yaml`
[Source: architecture/task-manager-architecture.md#14-deployment-architecture]

```yaml
name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm run lint && npm run typecheck && npm run test

  e2e:
    needs: quality
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npx playwright install --with-deps
      - run: npm run build && npm run test:e2e
```

### CÃ³digo: `vitest.config.ts`
[Source: architecture/task-manager-architecture.md#16-testing-strategy]

```typescript
import { defineConfig } from 'vitest/config'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts'],
    globals: true,
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
```

### CÃ³digo: `playwright.config.ts`
[Source: architecture/task-manager-architecture.md#16-testing-strategy]

```typescript
import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  use: {
    baseURL: 'http://localhost:3000',
  },
  projects: [
    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
})
```

### VariÃ¡veis de Ambiente
[Source: architecture/task-manager-architecture.md#13-development-workflow]

Criar `.env.example` (commitar) sem valores reais:

```bash
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
ANTHROPIC_API_KEY=
ENABLE_AI_FEATURES=false
SENTRY_DSN=
```

**CRÃTICO:** `.env.local` (com valores reais) NUNCA deve ser commitado. Adicionar ao `.gitignore`.

### PadrÃµes de CÃ³digo
[Source: architecture/task-manager-architecture.md#17-coding-standards]

| Elemento | ConvenÃ§Ã£o | Exemplo |
|----------|-----------|---------|
| Componentes | PascalCase | `TaskCard.tsx` |
| Hooks | camelCase + `use` | `useTaskList.ts` |
| ENV pÃºblicas | prefix `NEXT_PUBLIC_` | `NEXT_PUBLIC_SUPABASE_URL` |
| Arquivos App Router | convenÃ§Ã£o Next.js | `route.ts`, `page.tsx`, `layout.tsx` |

- **Server Components por padrÃ£o** â€” `'use client'` explÃ­cito apenas quando necessÃ¡rio
- **Sem nÃºmeros mÃ¡gicos** â€” constantes em `lib/constants.ts` (criar em story futura)

### ObservaÃ§Ãµes de Ambiente

- **Windows:** Todos os comandos `npx`/`npm` executam normalmente no PowerShell ou bash
- **Turbopack:** Habilitado por padrÃ£o no Next.js 16+ em desenvolvimento â€” nÃ£o adicionar flags extras
- **Vercel GitHub Integration:** O Vercel detecta automaticamente Next.js via GitHub App â€” nÃ£o Ã© necessÃ¡rio `deploy.yaml` separado; o `ci.yaml` cobre apenas a validaÃ§Ã£o de qualidade

### Testing
[Source: architecture/task-manager-architecture.md#16-testing-strategy]

**LocalizaÃ§Ã£o de testes:**
- UnitÃ¡rios: `src/**/*.test.ts` ou `src/**/*.spec.ts` (co-localizados com o cÃ³digo)
- E2E: `e2e/**/*.spec.ts`
- Setup file: `src/test/setup.ts`

**Cobertura mÃ­nima:** 80% em lÃ³gica crÃ­tica (NFR6). Nesta story, o mÃ­nimo Ã© o teste da rota `/api/health`.

**Teste mÃ­nimo para `/api/health`:**
```typescript
// src/app/api/health/route.test.ts
import { describe, it, expect } from 'vitest'
import { GET } from './route'

describe('GET /api/health', () => {
  it('retorna status ok com timestamp', async () => {
    const response = await GET()
    const body = await response.json()
    expect(response.status).toBe(200)
    expect(body.status).toBe('ok')
    expect(body.timestamp).toBeDefined()
  })
})
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-20 | 1.0 | Story criada | @sm (River) |
| 2026-02-20 | 1.1 | Status Draft â†’ Ready â€” GO (9/10, Confidence: High). Should-fix: dependÃªncias implÃ­citas Task 8â†’5 e Task 9â†’1-7 | @po (Pax) |
| 2026-02-20 | 1.2 | ImplementaÃ§Ã£o iniciada (YOLO mode). Tasks 1,2,3,5,6,7,8,9.3,10.1 completas. Tasks 4,8.2,8.3,9.1,9.2,9.4,10.2-10.4 aguardam aÃ§Ãµes externas (GitHub + Vercel). | @dev (Dex) |
| 2026-02-21 | 1.3 | Todas as tasks completas. GitHub repo criado, CI verde (5/5 runs). Vercel deploy ativo em https://task-manager-aios.vercel.app â€” HTTP 200, /api/health OK. Status â†’ Ready for Review. | @devops (Gage) |
| 2026-02-21 | 1.4 | Story fechada. Todos os 8 ACs verificados em produÃ§Ã£o. commit 0f9a54d. Status â†’ Done. | @po (Pax) |

---

## Dev Agent Record

### Agent Model Used

claude-sonnet-4-6 (YOLO mode)

### Debug Log References

- `create-next-app` nÃ£o pÃ´de ser executado na raiz (conflito com .aios-core, .claude, .env). SoluÃ§Ã£o: criado em `nextjs-init/` e arquivos copiados via Read+Write tools.
- PowerShell Copy-Item via bash causava arquivos de 1 byte. SoluÃ§Ã£o: Read+Write tools nativos.
- ESLint inicial falhava em `.aios-core` e `.claude` (CommonJS require). SoluÃ§Ã£o: adicionado `globalIgnores` para essas pastas.
- Vitest globals nÃ£o reconhecidos pelo TypeScript. SoluÃ§Ã£o: imports explÃ­citos em arquivos de teste.

### Completion Notes List

- AC1 âœ… â€” Next.js 16.1.6 + App Router + TypeScript rodando. `npm run dev` â†’ localhost:3000 OK.
- AC2 âœ… â€” Tailwind CSS 4.x (CSS-first) + shadcn/ui inicializado. Componentes: button, card, input, label criados em `src/components/ui/`.
- AC3 âœ… â€” ESLint 9 (flat config) + Prettier configurados. `npm run lint` e `npm run typecheck` passam sem erros.
- AC4 âœ… â€” RepositÃ³rio `Brun00000000/task-manager-aios` criado. Branches `main` e `develop` pushadas.
- AC5 âœ… â€” GitHub Actions CI verde. 5/5 runs com `success` (quality + e2e jobs).
- AC6 âœ… â€” Vercel conectado ao repo GitHub. Deploy em https://task-manager-aios.vercel.app â€” HTTP 200 confirmado.
- AC7 âœ… â€” `/api/health` retorna `{ status: "ok", timestamp }`. Teste unitÃ¡rio passando.
- AC8 âœ… â€” PÃ¡gina "Task Manager â€” Coming Soon" com Tailwind CSS.

### File List

**Criados:**
- `src/app/page.tsx` â€” PÃ¡gina Coming Soon
- `src/app/layout.tsx` â€” Layout raiz (metadata atualizada)
- `src/app/globals.css` â€” Tailwind 4 + shadcn CSS vars
- `src/app/api/health/route.ts` â€” Endpoint GET /api/health
- `src/app/api/health/route.test.ts` â€” Teste unitÃ¡rio da health route
- `src/test/setup.ts` â€” Setup do Vitest com @testing-library/jest-dom
- `src/lib/utils.ts` â€” UtilitÃ¡rio cn() do shadcn/ui
- `src/components/ui/button.tsx` â€” Componente Button (shadcn)
- `src/components/ui/card.tsx` â€” Componente Card (shadcn)
- `src/components/ui/input.tsx` â€” Componente Input (shadcn)
- `src/components/ui/label.tsx` â€” Componente Label (shadcn)
- `e2e/home.spec.ts` â€” Teste E2E da homepage
- `.github/workflows/ci.yaml` â€” Pipeline CI com jobs quality + e2e
- `vitest.config.ts` â€” ConfiguraÃ§Ã£o Vitest (jsdom, @/* alias, include src/)
- `playwright.config.ts` â€” ConfiguraÃ§Ã£o Playwright (Chromium, webServer)
- `.prettierrc` â€” ConfiguraÃ§Ã£o Prettier
- `.prettierignore` â€” Ignores do Prettier
- `components.json` â€” Config do shadcn/ui

**Modificados:**
- `package.json` â€” name="task-manager", scripts: typecheck, test, test:watch, test:e2e, format
- `next.config.ts` â€” Config Next.js
- `tsconfig.json` â€” TypeScript config com paths @/*
- `eslint.config.mjs` â€” ESLint 9 flat config com ignores para .aios-core, .claude
- `postcss.config.mjs` â€” @tailwindcss/postcss
- `.env.example` â€” Adicionada variÃ¡vel NEXT_PUBLIC_APP_URL

---

## QA Results

**Verdict:** PASS (inline â€” sem @qa formal para story de setup)

- CI GitHub Actions: 5/5 runs `success` âœ…
- ProduÃ§Ã£o Vercel: HTTP 200 âœ…
- `/api/health`: `{ status: "ok", timestamp }` âœ…
- Teste unitÃ¡rio: 1/1 passando âœ…
- lint + typecheck: sem erros âœ…
