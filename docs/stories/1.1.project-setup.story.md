# Story 1.1: Project Setup & CI/CD Pipeline

## Status
InProgress

## Executor Assignment

```yaml
executor: "@dev"
quality_gate: "@architect"
quality_gate_tools:
  - code-review
  - architecture-validation
  - ci-pipeline-verification
```

> **Work Type:** Code/Features/Logic + Infra/CI/CD/Deploy
> **Supporting Agent:** @devops (configura√ß√£o Vercel e GitHub Actions)

---

## Story

**As a** desenvolvedor,
**I want** o projeto Next.js inicializado com TypeScript, Tailwind e pipeline de CI/CD configurado,
**so that** a equipe tenha uma base est√°vel para construir todas as features subsequentes.

---

## Acceptance Criteria

1. Next.js 16+ com App Router e TypeScript inicializado e rodando localmente
2. Tailwind CSS + shadcn/ui configurados com tema padr√£o funcional
3. ESLint + Prettier configurados com regras do preset `nextjs-react`
4. Reposit√≥rio GitHub criado com branches `main` e `develop`
5. GitHub Actions executa lint + typecheck + testes a cada push/PR
6. Deploy autom√°tico na Vercel configurado (preview em PRs, produ√ß√£o no merge para `main`)
7. Rota `/api/health` retorna `{ status: "ok", timestamp }` com HTTP 200
8. P√°gina inicial exibe "Task Manager ‚Äî Coming Soon" confirmando deploy funcionando

---

## ü§ñ CodeRabbit Integration

> **CodeRabbit Integration**: Disabled
>
> CodeRabbit CLI is not enabled em `core-config.yaml`.
> Valida√ß√£o de qualidade usar√° processo de review manual.
> Para habilitar, defina `coderabbit_integration.enabled: true` em core-config.yaml

---

## Tasks / Subtasks

- [x] **Task 1: Inicializar projeto Next.js 16+** (AC: 1)
  - [x] 1.1 Executar `npx create-next-app@latest task-manager --typescript --tailwind --app --src-dir --import-alias "@/*"`
  - [x] 1.2 Verificar que `npm run dev` inicia sem erros em `localhost:3000`
  - [x] 1.3 Confirmar App Router funcional (pasta `src/app/` criada)
  - [x] 1.4 Confirmar TypeScript funcional (`tsconfig.json` v√°lido, sem erros de tipo)

- [x] **Task 2: Configurar Tailwind CSS + shadcn/ui** (AC: 2)
  - [x] 2.1 Verificar `tailwind.config.ts` gerado pelo `create-next-app` (Tailwind 4.x)
  - [x] 2.2 Inicializar shadcn/ui: `npx shadcn@latest init` (selecionar tema padr√£o)
  - [x] 2.3 Instalar componentes base: `npx shadcn@latest add button card input label`
  - [x] 2.4 Verificar que componentes shadcn importam e renderizam corretamente

- [x] **Task 3: Configurar ESLint + Prettier** (AC: 3)
  - [x] 3.1 Verificar `.eslintrc.json` gerado (deve estender `next/core-web-vitals`)
  - [x] 3.2 Instalar Prettier: `npm install -D prettier eslint-config-prettier`
  - [x] 3.3 Criar `.prettierrc` com configura√ß√£o padr√£o:
        `{ "semi": false, "singleQuote": true, "tabWidth": 2, "trailingComma": "es5" }`
  - [x] 3.4 Adicionar `"prettier"` ao extends do ESLint (ap√≥s `next/core-web-vitals`)
  - [x] 3.5 Adicionar script ao `package.json`: `"typecheck": "tsc --noEmit"`
  - [x] 3.6 Executar `npm run lint` e confirmar sem erros
  - [x] 3.7 Executar `npm run typecheck` e confirmar sem erros

- [ ] **Task 4: Configurar Reposit√≥rio GitHub** (AC: 4)
  - [ ] 4.1 Criar reposit√≥rio `task-manager` no GitHub (p√∫blico ou privado)
  - [ ] 4.2 Criar `.gitignore` incluindo: `.env.local`, `.env*.local`, `node_modules/`, `.next/`
  - [ ] 4.3 Push inicial para branch `main`
  - [ ] 4.4 Criar branch `develop` a partir de `main`: `git checkout -b develop && git push -u origin develop`

- [x] **Task 5: Configurar Ferramentas de Teste** (prerequisite para AC: 5)
  - [x] 5.1 Instalar Vitest + RTL: `npm install -D vitest @vitejs/plugin-react @testing-library/react @testing-library/jest-dom jsdom`
  - [x] 5.2 Criar `vitest.config.ts` (ver Dev Notes ‚Äî Se√ß√£o Testing)
  - [x] 5.3 Criar `src/test/setup.ts` com `import '@testing-library/jest-dom'`
  - [x] 5.4 Adicionar script ao `package.json`: `"test": "vitest run"`
  - [x] 5.5 Instalar Playwright: `npm install -D @playwright/test && npx playwright install`
  - [x] 5.6 Criar `playwright.config.ts` (ver Dev Notes ‚Äî Se√ß√£o Testing)
  - [x] 5.7 Adicionar script: `"test:e2e": "playwright test"`
  - [x] 5.8 Confirmar `npm run test` e `npm run test:e2e` passam (sem testes = pass)

- [x] **Task 6: Criar rota `/api/health`** (AC: 7)
  - [x] 6.1 Criar `src/app/api/health/route.ts` (ver Dev Notes ‚Äî c√≥digo exato)
  - [x] 6.2 Testar localmente: `curl http://localhost:3000/api/health` retorna `{ "status": "ok", "timestamp": "..." }`
  - [x] 6.3 Escrever teste unit√°rio: `src/app/api/health/route.test.ts` verificando status 200 e campos da resposta

- [x] **Task 7: Criar p√°gina inicial "Coming Soon"** (AC: 8)
  - [x] 7.1 Atualizar `src/app/page.tsx` com conte√∫do: `<h1>Task Manager ‚Äî Coming Soon</h1>`
  - [x] 7.2 Estilizar minimamente com Tailwind CSS

- [x] **Task 8: Configurar GitHub Actions CI/CD** (AC: 5)
  - [x] 8.1 Criar `.github/workflows/ci.yaml` com jobs `quality` e `e2e` (ver Dev Notes ‚Äî c√≥digo exato)
  - [ ] 8.2 Testar pipeline: push para `develop` e verificar workflow passa
  - [ ] 8.3 Confirmar que PR para `main` aciona workflow

- [ ] **Task 9: Configurar Vercel Deploy** (AC: 6)
  - [ ] 9.1 Conectar reposit√≥rio ao Vercel via dashboard (Import Project)
  - [ ] 9.2 Verificar deploy autom√°tico: push para `main` ‚Üí produ√ß√£o, PR ‚Üí preview
  - [x] 9.3 Criar `.env.example` com todas as vari√°veis (sem valores reais)
  - [ ] 9.4 Verificar URL de produ√ß√£o acess√≠vel e exibindo "Task Manager ‚Äî Coming Soon"

- [x] **Task 10: Verifica√ß√£o final e testes** (AC: 1-8)
  - [x] 10.1 Executar `npm run lint && npm run typecheck && npm run test` ‚Äî todos passando
  - [ ] 10.2 Verificar `/api/health` na URL de produ√ß√£o Vercel retorna HTTP 200
  - [ ] 10.3 Confirmar pipeline CI verde no GitHub Actions
  - [ ] 10.4 Confirmar deploy preview funciona em PRs

---

## Dev Notes

### Contexto da Story

Esta √© a story **fundacional** do projeto Task Manager. N√£o h√° c√≥digo existente ‚Äî tudo deve ser criado do zero via `create-next-app`. As pastas `features/`, `lib/`, `components/ui/` (shadcn), `types/` ser√£o estruturadas em stories subsequentes. N√£o criar estrutura antecipada al√©m do que os ACs exigem.

### Stack e Vers√µes
[Source: architecture/task-manager-architecture.md#3-tech-stack]

| Ferramenta | Vers√£o | Notas |
|-----------|--------|-------|
| Next.js | 16+ | App Router, TypeScript |
| TypeScript | 5.x | Configurado pelo create-next-app |
| Tailwind CSS | 4.x | Flag `--tailwind` no create-next-app |
| shadcn/ui | latest | `npx shadcn@latest init` |
| ESLint | latest | Configurado pelo create-next-app |
| Prettier | latest | Instalar manualmente |
| Vitest | 2.x | Com @testing-library/react (RTL) |
| Playwright | 1.x | E2E ‚Äî fluxos cr√≠ticos |
| Turbopack | ‚Äî | Bundler padr√£o em dev (Next.js 16+) |

### Estrutura de Pastas a Criar Nesta Story
[Source: architecture/task-manager-architecture.md#12-unified-project-structure]

```
task-manager/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îî‚îÄ‚îÄ ci.yaml              ‚Üê criar nesta story
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts     ‚Üê criar nesta story (AC: 7)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx             ‚Üê "Coming Soon" (AC: 8)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx           ‚Üê gerado pelo create-next-app
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ globals.css
‚îÇ   ‚îî‚îÄ‚îÄ test/
‚îÇ       ‚îî‚îÄ‚îÄ setup.ts             ‚Üê setup do Vitest
‚îú‚îÄ‚îÄ public/
‚îú‚îÄ‚îÄ e2e/                         ‚Üê criar pasta para Playwright
‚îú‚îÄ‚îÄ .env.example                 ‚Üê criar (sem valores reais)
‚îú‚îÄ‚îÄ .gitignore                   ‚Üê incluir .env.local
‚îú‚îÄ‚îÄ next.config.ts
‚îú‚îÄ‚îÄ tailwind.config.ts
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ vitest.config.ts             ‚Üê criar nesta story
‚îú‚îÄ‚îÄ playwright.config.ts         ‚Üê criar nesta story
‚îî‚îÄ‚îÄ package.json
```

**N√ÉO criar nesta story:** `supabase/`, `src/features/`, `src/lib/`, `src/types/`, `src/middleware.ts`

### C√≥digo: Rota `/api/health`
[Source: architecture/task-manager-architecture.md#5-api-specification]

```typescript
// src/app/api/health/route.ts
import { NextResponse } from 'next/server'

export async function GET() {
  return NextResponse.json({
    status: 'ok',
    timestamp: new Date().toISOString(),
  })
}
```

### C√≥digo: `.github/workflows/ci.yaml`
[Source: architecture/task-manager-architecture.md#14-deployment-architecture]

```yaml
name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm run lint && npm run typecheck && npm run test

  e2e:
    needs: quality
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npx playwright install --with-deps
      - run: npm run build && npm run test:e2e
```

### C√≥digo: `vitest.config.ts`
[Source: architecture/task-manager-architecture.md#16-testing-strategy]

```typescript
import { defineConfig } from 'vitest/config'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts'],
    globals: true,
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
```

### C√≥digo: `playwright.config.ts`
[Source: architecture/task-manager-architecture.md#16-testing-strategy]

```typescript
import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  use: {
    baseURL: 'http://localhost:3000',
  },
  projects: [
    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
})
```

### Vari√°veis de Ambiente
[Source: architecture/task-manager-architecture.md#13-development-workflow]

Criar `.env.example` (commitar) sem valores reais:

```bash
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
ANTHROPIC_API_KEY=
ENABLE_AI_FEATURES=false
SENTRY_DSN=
```

**CR√çTICO:** `.env.local` (com valores reais) NUNCA deve ser commitado. Adicionar ao `.gitignore`.

### Padr√µes de C√≥digo
[Source: architecture/task-manager-architecture.md#17-coding-standards]

| Elemento | Conven√ß√£o | Exemplo |
|----------|-----------|---------|
| Componentes | PascalCase | `TaskCard.tsx` |
| Hooks | camelCase + `use` | `useTaskList.ts` |
| ENV p√∫blicas | prefix `NEXT_PUBLIC_` | `NEXT_PUBLIC_SUPABASE_URL` |
| Arquivos App Router | conven√ß√£o Next.js | `route.ts`, `page.tsx`, `layout.tsx` |

- **Server Components por padr√£o** ‚Äî `'use client'` expl√≠cito apenas quando necess√°rio
- **Sem n√∫meros m√°gicos** ‚Äî constantes em `lib/constants.ts` (criar em story futura)

### Observa√ß√µes de Ambiente

- **Windows:** Todos os comandos `npx`/`npm` executam normalmente no PowerShell ou bash
- **Turbopack:** Habilitado por padr√£o no Next.js 16+ em desenvolvimento ‚Äî n√£o adicionar flags extras
- **Vercel GitHub Integration:** O Vercel detecta automaticamente Next.js via GitHub App ‚Äî n√£o √© necess√°rio `deploy.yaml` separado; o `ci.yaml` cobre apenas a valida√ß√£o de qualidade

### Testing
[Source: architecture/task-manager-architecture.md#16-testing-strategy]

**Localiza√ß√£o de testes:**
- Unit√°rios: `src/**/*.test.ts` ou `src/**/*.spec.ts` (co-localizados com o c√≥digo)
- E2E: `e2e/**/*.spec.ts`
- Setup file: `src/test/setup.ts`

**Cobertura m√≠nima:** 80% em l√≥gica cr√≠tica (NFR6). Nesta story, o m√≠nimo √© o teste da rota `/api/health`.

**Teste m√≠nimo para `/api/health`:**
```typescript
// src/app/api/health/route.test.ts
import { describe, it, expect } from 'vitest'
import { GET } from './route'

describe('GET /api/health', () => {
  it('retorna status ok com timestamp', async () => {
    const response = await GET()
    const body = await response.json()
    expect(response.status).toBe(200)
    expect(body.status).toBe('ok')
    expect(body.timestamp).toBeDefined()
  })
})
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-20 | 1.0 | Story criada | @sm (River) |
| 2026-02-20 | 1.1 | Status Draft ‚Üí Ready ‚Äî GO (9/10, Confidence: High). Should-fix: depend√™ncias impl√≠citas Task 8‚Üí5 e Task 9‚Üí1-7 | @po (Pax) |
| 2026-02-20 | 1.2 | Implementa√ß√£o iniciada (YOLO mode). Tasks 1,2,3,5,6,7,8,9.3,10.1 completas. Tasks 4,8.2,8.3,9.1,9.2,9.4,10.2-10.4 aguardam a√ß√µes externas (GitHub + Vercel). | @dev (Dex) |

---

## Dev Agent Record

### Agent Model Used

claude-sonnet-4-6 (YOLO mode)

### Debug Log References

- `create-next-app` n√£o p√¥de ser executado na raiz (conflito com .aios-core, .claude, .env). Solu√ß√£o: criado em `nextjs-init/` e arquivos copiados via Read+Write tools.
- PowerShell Copy-Item via bash causava arquivos de 1 byte. Solu√ß√£o: Read+Write tools nativos.
- ESLint inicial falhava em `.aios-core` e `.claude` (CommonJS require). Solu√ß√£o: adicionado `globalIgnores` para essas pastas.
- Vitest globals n√£o reconhecidos pelo TypeScript. Solu√ß√£o: imports expl√≠citos em arquivos de teste.

### Completion Notes List

- AC1 ‚úÖ ‚Äî Next.js 16.1.6 + App Router + TypeScript rodando. `npm run dev` ‚Üí localhost:3000 OK.
- AC2 ‚úÖ ‚Äî Tailwind CSS 4.x (CSS-first) + shadcn/ui inicializado. Componentes: button, card, input, label criados em `src/components/ui/`.
- AC3 ‚úÖ ‚Äî ESLint 9 (flat config) + Prettier configurados. `npm run lint` e `npm run typecheck` passam sem erros.
- AC4 ‚è≥ ‚Äî Aguarda a√ß√£o do usu√°rio: criar reposit√≥rio GitHub e configurar branches.
- AC5 ‚úÖ ‚Äî `.github/workflows/ci.yaml` criado com jobs `quality` e `e2e`. Verifica√ß√£o online depende de AC4.
- AC6 ‚è≥ ‚Äî Aguarda a√ß√£o do usu√°rio: conectar Vercel ao reposit√≥rio GitHub.
- AC7 ‚úÖ ‚Äî `/api/health` retorna `{ status: "ok", timestamp }`. Teste unit√°rio passando.
- AC8 ‚úÖ ‚Äî P√°gina "Task Manager ‚Äî Coming Soon" com Tailwind CSS.

### File List

**Criados:**
- `src/app/page.tsx` ‚Äî P√°gina Coming Soon
- `src/app/layout.tsx` ‚Äî Layout raiz (metadata atualizada)
- `src/app/globals.css` ‚Äî Tailwind 4 + shadcn CSS vars
- `src/app/api/health/route.ts` ‚Äî Endpoint GET /api/health
- `src/app/api/health/route.test.ts` ‚Äî Teste unit√°rio da health route
- `src/test/setup.ts` ‚Äî Setup do Vitest com @testing-library/jest-dom
- `src/lib/utils.ts` ‚Äî Utilit√°rio cn() do shadcn/ui
- `src/components/ui/button.tsx` ‚Äî Componente Button (shadcn)
- `src/components/ui/card.tsx` ‚Äî Componente Card (shadcn)
- `src/components/ui/input.tsx` ‚Äî Componente Input (shadcn)
- `src/components/ui/label.tsx` ‚Äî Componente Label (shadcn)
- `e2e/home.spec.ts` ‚Äî Teste E2E da homepage
- `.github/workflows/ci.yaml` ‚Äî Pipeline CI com jobs quality + e2e
- `vitest.config.ts` ‚Äî Configura√ß√£o Vitest (jsdom, @/* alias, include src/)
- `playwright.config.ts` ‚Äî Configura√ß√£o Playwright (Chromium, webServer)
- `.prettierrc` ‚Äî Configura√ß√£o Prettier
- `.prettierignore` ‚Äî Ignores do Prettier
- `components.json` ‚Äî Config do shadcn/ui

**Modificados:**
- `package.json` ‚Äî name="task-manager", scripts: typecheck, test, test:watch, test:e2e, format
- `next.config.ts` ‚Äî Config Next.js
- `tsconfig.json` ‚Äî TypeScript config com paths @/*
- `eslint.config.mjs` ‚Äî ESLint 9 flat config com ignores para .aios-core, .claude
- `postcss.config.mjs` ‚Äî @tailwindcss/postcss
- `.env.example` ‚Äî Adicionada vari√°vel NEXT_PUBLIC_APP_URL

---

## QA Results

*(A ser preenchido pelo @qa ap√≥s implementa√ß√£o)*
